# Q: what is the best assembly for short reads mapping
# A: 
The overall approach involves using the primary assembly from hifiasm as the basic haplotype scaffold. Then, align both hifiasm unitigs and hicanu contigs (which are relatively complete diploid assemblies) to the primary assembly. Variants are called separately using htsbox. Subsequently, only the variants that are present in both hifiasm unitig and hicanu and have a site depth of 2 are retained as high-quality variations. If the variation is a homozygous mutation, the bases in the primary assembly are directly replaced. For heterozygous mutations, they are divided into: 1) high-quality large insertions, which are integrated directly into the primary assembly, and 2) small variations, for which a haplotype variants graph is constructed using vg.   

## HiFiasm   
```
/tmp/global2/wxian/software/hifiasm-0.19.8/hifiasm -o Oak -t 128 ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.10.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.11.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.12.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.13.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.14.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.15.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.16.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.17.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.18.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.19.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.1.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.20.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.21.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.22.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.23.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.24.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.25.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.26.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.27.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.28.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.29.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.2.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.30.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.31.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.32.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.3.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.4.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.5.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.6.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.7.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.8.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220112_082130.subreads.bam.9.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.10.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.11.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.12.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.13.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.14.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.15.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.16.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.17.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.18.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.19.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.1.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.20.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.21.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.22.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.23.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.24.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.25.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.26.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.27.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.28.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.29.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.2.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.30.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.31.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.32.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.3.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.4.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.5.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.6.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.7.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.8.deepconsensus.fastq.gz ../00.ccs_deepconsensus/m64079_220113_191635.subreads.bam.9.deepconsensus.fastq.gz 
```
## Hicanu
```
/tmp/global2/wxian/software/canu-2.2/build/bin/canu -p Oak -d Oak genomeSize=760m -pacbio-hifi reads/*gz
```

## post-process the primary assembly

```
minimap2 -ax asm20 --cs -r2k -t64 Oak.bp.p_ctg.gfa.fa Oak.bp.p_utg.gfa.fa | samtools sort -@12 -o Oak.bp.p_ctg.gfa.fa_Oak.bp.p_utg.gfa.fa.sorted.bam -
minimap2 -ax asm20 --cs -r2k -t64 Oak.bp.p_ctg.gfa.fa Oak.contigs.fasta | samtools sort -@12 -o Oak.bp.p_ctg.gfa.fa_Oak.contigs.fasta.sorted.bam -
/tmp/global2/wxian/software/htsbox/htsbox pileup -q20 -S300 -v -c -f Oak.bp.p_ctg.gfa.fa Oak.bp.p_ctg.gfa.fa_Oak.bp.p_utg.gfa.fa.sorted.bam  > Oak.bp.p_ctg.gfa.fa_Oak.bp.p_utg.gfa.fa.sorted.bam.vcf
/tmp/global2/wxian/software/htsbox/htsbox pileup -q20 -S300 -v -c -f Oak.bp.p_ctg.gfa.fa Oak.bp.p_ctg.gfa.fa_Oak.contigs.fasta.sorted.bam  > Oak.bp.p_ctg.gfa.fa_Oak.contigs.fasta.sorted.bam.vcf
```
